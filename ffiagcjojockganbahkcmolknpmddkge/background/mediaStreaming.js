(function(_,E,T,e){var a=new T;var s;class i{constructor(){if(s){return s}else{s=this;this.IsSwitchPage=true;this.IsPlaying=false;this.Started=false;this.IgnoreGetTime=false;this.TotalTime=0;this.CurrTime=0;this.LastMedia=null;this.MediaSrc="";this.callbacks={OnStart:null,OnTotalTime:null,OnCurrTime:null,OnFinish:null,OnError:null}}}Start(_){a.CallPlayViaJS=false;if(_)this.LastMedia=_;if(a.Size()>0&&!a.IsMediaPageMatch(this.LastMedia.page,a.CurrentPos())&&this.IsSwitchPage)a.Clear();E.callbacks.mediaStreaming=this.ProcessRx.bind(this);this.MediaSrc=this.LastMedia.src;E.sendAVCmd(AVSTREES_CMD.AV_HTTP_START,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID);this.IsPlaying=true;this.IsSwitchPage=true}End(_,T){E.callbacks.mediaStreaming=undefined;E.sendAVCmd(AVSTREES_CMD.AV_HTTP_STOP,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID);this.Cleanup();if(T)T();else if(this.callbacks.OnFinish)this.callbacks.OnFinish(_)}Cleanup(){this.TotalTime=0;this.CurrTime=0;this.MediaSrc="";this.IsPlaying=false;this.Started=false}GetPlaylist(_){if(a.Size<=0||!a.CallPlayViaJS){a.CreateListFromJSON(_)}else{a.Insert(_)}a.Play()}HasNext(){return a.HasNext()}HasPrev(){return a.HasPrev()}Playnext(){this.IsSwitchPage=false;a.PlayNext()}Playprev(){this.IsSwitchPage=false;a.PlayPrev()}Seek(_){if(this.TotalTime>0&&_>0){this.IgnoreGetTime=true;var T=new ArrayBuffer(AV_SIZE_INT32);var e=new DataView(T);e.setInt32(0,_,true);E.sendAVCmd(AVSTREES_CMD.AV_PLAYER_SEEKPLAY,AV_TYPE.AV_TYPE_INT32,AV_SIZE_INT32,T)}}VolUp(){E.sendAVCmd(AVSTREES_CMD.AV_PLAYER_VOLUME_UP,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID)}VolDown(){E.sendAVCmd(AVSTREES_CMD.AV_PLAYER_VOLUME_DOWN,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID)}Pause(){E.sendAVCmd(AVSTREES_CMD.AV_PLAYER_PAUSE,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID)}Resume(){E.sendAVCmd(AVSTREES_CMD.AV_PLAYER_RESUME,AV_TYPE.AV_TYPE_VOID,AV_SIZE_VOID)}ProcessRx(_,T,s,i,t){switch(_){case AVSTREES_CMD.AV_HTTP_GET_URL:var R=e.str2ab(this.MediaSrc);E.sendAVCmd(AVSTREES_CMD.AV_HTTP_GET_URL,AV_TYPE.AV_TYPE_UTF8,R.byteLength,R);break;case AVSTREES_CMD.AV_HTTP_GET_USERAGENT:var A=e.str2ab(MYuserAgent);E.sendAVCmd(AVSTREES_CMD.AV_HTTP_GET_USERAGENT,AV_TYPE.AV_TYPE_UTF8,A.byteLength,A);break;case AVSTREES_CMD.AV_HTTP_STOP:this.IsSwitchPage=false;this.End(this.HasNext());break;case AVSTREES_CMD.AV_HTTP_START:if(i==AV_RESULT_TYPE.AV_RESULT_OK){this.Started=true;var S=a.Size()>0?this.LastMedia.title+"("+(a.CurrentPos()+1).toString()+"/"+a.Size()+")":this.LastMedia.title;if(this.callbacks.OnStart)this.callbacks.OnStart(S);if(this.callbacks.OnTotalTime)this.callbacks.OnTotalTime(0)}break;case AVSTREES_CMD.AV_PLAYER_GET_LENGTH:if(T==AV_TYPE.AV_TYPE_INT32&&s==AV_SIZE_INT32){var V=new DataView(t);this.TotalTime=V.getInt32(0,t,true);if(this.callbacks.OnTotalTime)this.callbacks.OnTotalTime(this.TotalTime)}break;case AVSTREES_CMD.AV_PLAYER_GET_TIME:if(T==AV_TYPE.AV_TYPE_INT32&&s==AV_SIZE_INT32){if(!this.IgnoreGetTime){var r=new DataView(t);this.CurrentTime=r.getInt32(0,t,true);if(this.callbacks.OnCurrTime)this.callbacks.OnCurrTime(this.CurrentTime)}}break;case AVSTREES_CMD.AV_PLAYER_SEEKPLAY:this.IgnoreGetTime=false;break}if(i!=AV_RESULT_TYPE.AV_RESULT_OK&&i!=AV_RESULT_TYPE.AV_RESULT_ERROR_GENERIC){this.Error(i)}}Error(_){var E="OK";switch(_){case AV_RESULT_TYPE.AV_RESULT_ERROR_GENERIC:E="AV_RESULT_ERROR_GENERIC";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_START_INIT_FAILED:E="AV_RESULT_ERROR_START_INIT_FAILED";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_START_OCCUPIED_OTHER_USER:E="AV_RESULT_ERROR_START_OCCUPIED_OTHER_USER";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_START_OCCUPIED_ALREADY_STREAMING:E="AV_RESULT_ERROR_START_OCCUPIED_ALREADY_STREAMING";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_STOP_FILE_FORMAT_UNSOPPORTED:E="AV_RESULT_ERROR_STOP_FILE_FORMAT_UNSOPPORTED";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_STOP_ABORTED:E="AV_RESULT_ERROR_STOP_ABORTED";break;case AV_RESULT_TYPE.AV_RESULT_ERROR_URL_DIVERT_LINK_ERROR:E="AV_RESULT_ERROR_URL_DIVERT_LINK_ERROR";break;case AV_RESULT_TYPE.ERROR_CANNOT_CONNECT:E="ERROR_CANNOT_CONNECT";break}this.Cleanup();if(this.callbacks.OnError&&_!=AV_RESULT_TYPE.AV_RESULT_OK)this.callbacks.OnError(chrome.i18n.getMessage(E));if(this.callbacks.OnFinish)this.callbacks.OnFinish(false)}}_["Media"]=new i})(window["ESHARECMCLIENTBG"]["background"],window["ESHARECMCLIENTBG"]["background"]["EMirroring"],window["ESHARECMCLIENTBG"]["background"]["Playlist"],window["ESHARECMCLIENTBG"]["Util"]);
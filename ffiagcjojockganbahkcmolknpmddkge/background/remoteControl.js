(function(e,t,n,s,o){var i;var r;var c=new n;var a=new s;var u=[];var l="";var d;function h(){if(d){return d}d=this;this.IsConnected=false;this.Asking=false;this.callbacks={connect:null,disconnect:null,OnRequestStream:null,OnGuestAsk:null,OnGuestCancel:null,OnHostAnswer:null,OnGetService:null,OnError:null};c.cbRecvMethod[c.JSONRecvMethod.AssignRole]=this.OnAssignRole.bind(this);c.cbRecvMethod[c.JSONRecvMethod.AskStream]=this.OnGuestAskMe.bind(this);c.cbRecvMethod[c.JSONRecvMethod.AnswerRequest]=this.OnHostAnswerMe.bind(this);c.cbRecvMethod[c.JSONRecvMethod.CancelRequest]=this.OnGuestCancelMe.bind(this);c.cbRecvResult[c.JSONSendMethod.RequestStream]=this.OnRequestStream.bind(this);c.cbRecvResult[c.JSONSendMethod.GetService]=this.OnGetService.bind(this);c.OnSendReply=this.sendJSON.bind(this)}function p(e){console.warn("[remoteControl] Triggered parseRecvBuffer! "+e)}h.prototype.Role=function(){return c.Role()};h.prototype.SetNoDisturb=function(e){c.SetNoDisturb(e)};h.prototype.SetAutoAllow=function(e){c.SetAutoAllow(e)};h.prototype.connect=function(e,t){if(e&&t){this.setDevice(e);t()}};h.prototype.disconnect=function(){u=[];this.stopHB();if(i){i.disconnect((function(){console.log("RemoteControl disconnected")}));i=undefined}this.IsConnected=false};h.prototype.OnConnected=function(){this.IsConnected=true;if(this.callbacks.connect)this.callbacks.connect()};h.prototype.OnHostAnswerMe=function(e){if(this.callbacks.OnHostAnswer)this.callbacks.OnHostAnswer(e)};h.prototype.OnGuestAskMe=function(e){u.push(e);this.PrepareAnswerGuest()};h.prototype.OnGuestCancelMe=function(e){for(var t=0;t<u.length;t++){if(u[t]===e){u.splice(t,1);break}}if(this.callbacks.OnGuestCancel)this.callbacks.OnGuestCancel();this.Asking=false;this.PrepareAnswerGuest()};h.prototype.PrepareAnswerGuest=function(){if(u.length>0&&!this.Asking){var e=u[0];u.shift();if(this.callbacks.OnGuestAsk){this.Asking=true;l=e;this.callbacks.OnGuestAsk(e)}}};h.prototype.OnAssignRole=function(e){if(!this.IsConnected)this.OnConnected();this.sendJSON(c.getService());f(e)};function f(e){chrome.runtime.sendMessage({uiAction:"updateEzBoardButton",role:e});chrome.runtime.sendMessage({uiAction:"roleChanged",role:e});b(e)}function b(e){chrome.storage.local.set({role:e});var t={function:"MagicBoardAppProxy.handleAppRoleChanged",role:e};chrome.runtime.sendMessage({detail:t})}h.prototype.OnRequestStream=function(e){if(this.callbacks.OnRequestStream)this.callbacks.OnRequestStream(e)};h.prototype.OnGetService=function(e){if(this.callbacks.OnGetService)this.callbacks.OnGetService(e)};h.prototype.cancelRequest=function(){this.sendJSON(c.cancelRequest())};h.prototype.answerGuest=function(e){this.sendJSON(c.answerGuest(e,l));this.Asking=false;this.PrepareAnswerGuest()};h.prototype.requestStream=function(e){this.sendJSON(c.requestStream());this.callbacks.OnRequestStream=e};h.prototype.receiveTcpMsg=function(e){var t=0;var n=new DataView(e.data);do{var s=n.getUint32(t,true);var i=o.ab2str(e.data.slice(t+4,t+4+s));p(i);t=t+4+s}while(t<e.data.byteLength)};h.prototype.startHB=function(){this.heartbeatTimer=setInterval(function(){this.sendJSON(c.heartbeat())}.bind(this),2e3)};h.prototype.stopHB=function(){if(this.heartbeatTimer){clearInterval(this.heartbeatTimer);this.heartbeatTimer=undefined}};h.prototype.addDevice=function(e,t){a.addProjector(e,t)};h.prototype.cleanDevice=function(){a.clean()};h.prototype.setDevice=function(e){a.setProjector(e)};h.prototype.getCurrDevice=function(){return a.currentDevice};h.prototype.CreateDevice=function(e,t){return a.CreateProjector(e,t)};h.prototype.sendKey=function(e){this.send(o.str2ab("1:"+e))};h.prototype.sendKeyboard=function(e){this.send(o.str2ab("2:"+e))};h.prototype.sendString=function(e){this.send(o.str2ab("5:1:"+e))};h.prototype.sendVendorKey=function(e){this.send(o.str2ab("10:"+e))};h.prototype.sendVendorString=function(e){this.send(o.str2ab("11:1:"+e))};h.prototype.sendJSON=function(e){this.send(o.str2ab("6:"+e))};h.prototype.send=function(e){if(!i.isConnected){console.log("RemoteControl not connected");return}var t=new ArrayBuffer(4);var n=new DataView(t);n.setUint32(0,e.byteLength,true);i.send(o.appendBuffer(t,e))};e["Remote"]=new h})(window["ESHARECMCLIENTBG"]["background"],window["ESHARECMCLIENTBG"]["NetWork"]["TcpSocket"],window["ESHARECMCLIENTBG"]["background"]["JSONHandler"],window["ESHARECMCLIENTBG"]["background"]["Projector"],window["ESHARECMCLIENTBG"]["Util"]);
chrome.runtime.sendMessage({action:"startGetImg"});var TVMirrorActionProc={};let relativeX,relativeY,previousId=0,isFirstJpg=!0,isCtrBarCalled=!1;var canvas111,cContext,asd,MirrorStatus=0,MirrorEdit=!1,stringcolor="#FFFFFF",stringPenSize=.33;let tvWindow=chrome.app.window.get("tvMirrorsWinodw");tvWindow.onFullscreened.addListener((function(){$(".drawing-board-canvas-wrapper").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"}),$(".drawing-board-canvas").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"})})),tvWindow.onRestored.addListener((function(){$(".drawing-board-canvas-wrapper").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"}),$(".drawing-board-canvas").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"})})),tvWindow.restore();let btnPict={getControlBarButtonPressed:"icon_arrow_right_pressed.png",getControlBarButton:"icon_arrow_right.png",homeButtonPressed:"icon_home_right_panel_pressed.png",homeButton:"icon_home_right_panel.png",backButtonPressed:"icon_right_panel_back_pressed.png",backBtton:"icon_right_panel_back.png"};var reg=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;function converRgbToArgb(e,t,o){return 255<<24|e<<16|t<<8|o}function colorToInt(e){return e=converRgbToArgb((e=(e=e.colorRgb()).split(","))[0],e[1],e[2])}function getMousePos(e){var t=corrdinateProcess(e.clientX,e.clientY);e.clientX,rect.left,canvas111.width,rect.width,e.clientY,rect.top,canvas111.height,rect.height;chrome.runtime.sendMessage({action:"drawMsg",x:t.x,y:t.y,actionStatus:2});t.x,t.y}function corrdinateProcess(e,t,o){e.width(),e.height();return tvWindow.isMaximized()?(relativeX=1280*t/e.width(),relativeY=720*o/e.height(),{x:relativeX,y:relativeY}):(relativeX=1280*t/e.width(),relativeY=720*o/e.height(),{x:relativeX,y:relativeY-45})}function btnClickView(e,t,o){document.getElementById(e).src="images/"+o,$("#"+e).mouseup((function(o){document.getElementById(e).src="images/"+t})),$("#"+e).mouseleave((function(o){document.getElementById(e).src="images/"+t}))}String.prototype.colorHex=function(){var e=this;if(/^(rgb|RGB)/.test(e)){for(var t=e.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),o="#",i=0;i<t.length;i++){var r=Number(t[i]).toString(16);"0"===r&&(r+=r),o+=r}return 7!==o.length&&(o=e),o}if(!reg.test(e))return e;var n=e.replace(/#/,"").split("");if(6===n.length)return e;if(3===n.length){var s="#";for(i=0;i<n.length;i+=1)s+=n[i]+n[i];return s}},String.prototype.colorRgb=function(){var e=this.toLowerCase();if(e&&reg.test(e)){if(4===e.length){for(var t="#",o=1;o<4;o+=1)t+=e.slice(o,o+1).concat(e.slice(o,o+1));e=t}var i=[];for(o=1;o<7;o+=2)i.push(parseInt("0x"+e.slice(o,o+2)));return i.join(",")}return e},setInterval((function(){chrome.runtime.sendMessage({action:"getImg"})}),150),TVMirrorActionProc.onStartTvMirror=function(e){let t=document.getElementById("returnsimg"),o=document.getElementById("returnsimgzhe");if(t.classList.contains("noData")&&(previousId=e.id,isFirstJpg=!1,t.classList.remove("noData"),setTimeout((()=>{t.style="position: absolute;margin:0;padding:0;width:100%;height:100%;bottom: 0px;",o.style="position: absolute;margin:0;padding:0;width:100%;height:100%;bottom: 0px;",setTimeout((()=>{let o="data:imge/jpeg;base64,"+e.jpgStr;t.src=o}),140)}),1)),e.id===previousId+1||e.id>=previousId+2){previousId=e.id;let o="data:imge/jpeg;base64,"+e.jpgStr;t.src=o}tvWindow=chrome.app.window.get("tvMirrorsWinodw")},TVMirrorActionProc.onStopTvMirror=function(e){tvWindow.close()},TVMirrorActionProc.sendMirror=function(e){let t=JSON.parse(e.data),o=!1,i=!1;if("common"==t.protocol&&(i=!0),"boxlight"==t.protocol&&(o=!0),MirrorStatus!=t.mirrorMode&&i||MirrorStatus!=MirrorStatus.hostInteract&&o)if(i?MirrorStatus=t.mirrorMode:o&&(MirrorStatus=t.hostInteract),0==MirrorStatus&&i||-1==MirrorStatus&&o)MirrorEdit=!1,MirrorView=!1;else if(1==MirrorStatus&&i||1==MirrorStatus&&o)MirrorEdit=!0,MirrorView=!1;else if(2==MirrorStatus&&i||0==MirrorStatus&&o){if(MirrorEdit=!1,MirrorView=!0,"none"!=$("#returnsimgzhe").css("display")&&"none"==$("#displaytext").css("display")){var r=$("#imgBox").width();r=(r-280)/2,$("#displaytext").css({display:"block",left:r+"px"}),$("#displaytext_Ccontext p").text(chrome.i18n.getMessage("closeScreen")),$("#displaytext_Cyes").text(chrome.i18n.getMessage("Determine")),$("#displaytext_Ccancel").text(chrome.i18n.getMessage("cancel"))}$("#returnsimgzhe").css("display","none"),$("#colorButton").css("background","rgba(0,0,0,0)")}else 3==MirrorStatus&&i&&(MirrorEdit=!1,MirrorView=!1)},chrome.runtime.onMessage.addListener((function(e,t,o){e.tvMirrorAction&&TVMirrorActionProc[e.tvMirrorAction]&&TVMirrorActionProc[e.tvMirrorAction](e)})),$("#returnsimg").mousedown((function(e){let t=corrdinateProcess($(this),e.pageX,e.pageY);chrome.runtime.sendMessage({action:"mouseEvent",x:t.x,y:t.y,cmd:0,rightClick:!1})})),$("#returnsimg").mousemove((function(e){let t=corrdinateProcess($(this),e.pageX,e.pageY);chrome.runtime.sendMessage({action:"mouseEvent",x:t.x,y:t.y,cmd:2,rightClick:!1})})),window.onkeydown=function(e){let t=e.which||e.keyCode;48<=t&&t<=57?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:t-41}):65<=t&&t<=90?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:t-36}):13==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:66}):8==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:67}):27==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:111}):46==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:112}):9==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:61}):19==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:121}):45==t?chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:124}):20==t&&chrome.runtime.sendMessage({action:"KeyCodeEvent",keyCode:115})},$("#returnsimg").mouseup((function(e){let t=corrdinateProcess($(this),e.pageX,e.pageY);0!==e.button?chrome.runtime.sendMessage({action:"mouseEvent",x:t.x,y:t.y,cmd:1,rightClick:!0}):chrome.runtime.sendMessage({action:"mouseEvent",x:t.x,y:t.y,cmd:1})})),$("#fullscreen").click((function(e){tvWindow=chrome.app.window.get("tvMirrorsWinodw");tvWindow.isMaximized;if(tvWindow.isMaximized())return document.getElementById("titleBar").style="position:relative;",document.getElementById("imgBox").style="position: absolute;width: 100%; top:40px;bottom: 0px;",document.getElementById("fullscreen").style="background:blue;position:absolute;top:15px;right:15px;width:30px;height: 30px;",document.getElementById("fullscreen").src="images/menu_fullscreen.png",document.getElementById("fullscreen").background="blue",tvWindow.restore(),$(".drawing-board-canvas-wrapper").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"}),void $(".drawing-board-canvas").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"});document.getElementById("titleBar").style="position: relative;display:none",document.getElementById("imgBox").style="width: 100%;height: 100%; position: relative;",document.getElementById("fullscreen").style="background:blue;position:absolute;top:15px;right:15px;width:30px;height: 30px;",document.getElementById("fullscreen").src="images/menu_normal.png",tvWindow.maximize(),$(".drawing-board-canvas-wrapper").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"}),$(".drawing-board-canvas").css({position:"absoulte",bottom:"0px",width:"100%",height:"100%"})})),$("#getControlBarButton").mousedown((function(e){btnClickView("getControlBarButton",btnPict.getControlBarButton,btnPict.getControlBarButtonPressed)})),$("#homeButton").mousedown((function(e){btnClickView("homeButton",btnPict.homeButton,btnPict.homeButtonPressed)})),$("#backButton").mousedown((function(e){btnClickView("backButton",btnPict.backBtton,btnPict.backButtonPressed)})),$("#controlBarButton").click((function(e){isCtrBarCalled=!0,tvWindow=chrome.app.window.get("tvMirrorsWinodw"),$("#controlBarButton").animate({right:"-100px"},300),$("#controlBar").animate({right:"0px"},300)})),$("#getControlBarButton").click((function(e){isCtrBarCalled=!1,tvWindow=chrome.app.window.get("tvMirrorsWinodw"),$("#controlBarButton").animate({right:"0px"},300),$("#controlBar").animate({right:"-100px"},300)})),$("#homeButton").click((function(e){if(MirrorView){var t=$("#imgBox").width();t=(t-280)/2,$("#displaytext").css({display:"block",left:t+"px"}),$("#displaytext_Ccontext p").text(chrome.i18n.getMessage("closeScreen")),$("#displaytext_Cyes").text(chrome.i18n.getMessage("Determine")),$("#displaytext_Ccancel").text(chrome.i18n.getMessage("cancel"))}else chrome.runtime.sendMessage({action:"keyEvent",cmd:3})})),$("#displaytext_Cyes").click((function(e){$("#displaytext").css("display","none")})),$("#displaytext_Ccancel").click((function(e){$("#displaytext").css("display","none")})),$("#backButton").click((function(e){if(MirrorView){var t=$("#imgBox").width();t=(t-280)/2,$("#displaytext").css({display:"block",left:t+"px"}),$("#displaytext_Ccontext p").text(chrome.i18n.getMessage("closeScreen")),$("#displaytext_Cyes").text(chrome.i18n.getMessage("Determine")),$("#displaytext_Ccancel").text(chrome.i18n.getMessage("cancel"))}else chrome.runtime.sendMessage({action:"keyEvent",cmd:4})})),$("#colorButton").click((function(e){if(MirrorView){var t=$("#imgBox").width();t=(t-280)/2,$("#displaytext").css({display:"block",left:t+"px"}),$("#displaytext_Ccontext p").text(chrome.i18n.getMessage("closeScreen")),$("#displaytext_Cyes").text(chrome.i18n.getMessage("Determine")),$("#displaytext_Ccancel").text(chrome.i18n.getMessage("cancel"))}else"none"==$("#returnsimgzhe").css("display")?($("#returnsimgzhe").css("display","block"),$("#colorButton").css("background","rgba(0,0,0,0.5)"),asd||(asd=new DrawingBoard.Board("returnsimgzhe",{controls:!1,size:3,color:"#C43F15",webStorage:!1,background:!1,controlsPosition:"center"})),chrome.runtime.sendMessage({action:"drawStart",isNote:1})):($("#colorButton").css("background","rgba(0,0,0,0)"),chrome.runtime.sendMessage({action:"drawStart",isNote:0}),$("#returnsimgzhe").css("display","none"))})),$(".drawing-board-canvas-wrapper").mousedown((function(e){})),$("#setcolorButton").click((function(){asd.setColor("#ffffff"),asd.resetsendcolor(colorToInt("#ffffff"))})),$("#setsizeButton").click((function(){asd.resetsize(5)})),$("#clearButton").click((function(){if(MirrorView){var e=$("#imgBox").width();e=(e-280)/2,$("#displaytext").css({display:"block",left:e+"px"}),$("#displaytext_Ccontext p").text(chrome.i18n.getMessage("closeScreen")),$("#displaytext_Cyes").text(chrome.i18n.getMessage("Determine")),$("#displaytext_Ccancel").text(chrome.i18n.getMessage("cancel"))}else asd.removepencil(),chrome.runtime.sendMessage({action:"clearDraw",isbooleam:!0})})),$("#minimized").click((function(){tvWindow=chrome.app.window.get("tvMirrorsWinodw"),tvWindow.minimize()})),$("#close").click((function(){tvWindow=chrome.app.window.get("tvMirrorsWinodw"),tvWindow.close()}));
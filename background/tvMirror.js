(function(e,t,i,s){var n;class h{constructor(){if(n){return n}else{n=this;this.cmdSocket=i;this.hubIp=null;this.hubPort=48689;this.mNum=0;this.imgByte=[];this.jpgBase64=null;this.isRepeat=false;this.jpgNumber=0}}getImageJpeg(e,s,n){this.hubIp=e;let h=t.intToBytesInt32(s);i.init(this.hubIp,this.hubPort,function(e){if(!e.isReceive){i.send(h,this.hubIp,this.hubPort,(function(e){console.log("send udp success")}))}else if(e.result.data.byteLength===1450){this.isReceive=true;let t=null;t=this.processPacket(e.result.data);if(t){this.jpgBase64=t}if(this.jpgBase64!==null&&this.jpgUnPacked.id!==this.jpgNumber){this.jpgNumber=this.jpgUnPacked.id;n({jpgStr:this.jpgBase64,id:this.jpgUnPacked.id})}this.jpgBase64=null}}.bind(this))}keepGettingJpeg(e,s,n){this.hubIp=e;let h=t.intToBytesInt32(s);i.send(h,this.hubIp,this.hubPort,(function(e){}))}processPacket(e){this.jpgUnPacked={option:t.bytesToInt32(e.slice(0,4)),one:t.bytesToInt32(e.slice(4,8)),id:t.bytesToUInt64(e.slice(8,16)),jpgLenght:t.bytesToInt32(e.slice(16,20)),packetNum:t.bytesToInt32(e.slice(20,24)),sumTotal:t.bytesToInt32(e.slice(24,28)),time:t.bytesToUInt64(e.slice(28,36)),jpgPacketSize:t.bytesToInt32(e.slice(36,40)),rotation:t.bytesToInt32(e.slice(40,44)),imgData:null};if(this.jpgUnPacked.jpgPacketSize){this.jpgUnPacked.imgData=e.slice(44,this.jpgUnPacked.jpgPacketSize+44)}if(this.mNum>0&&this.mNum<this.jpgUnPacked.sumTotal&&this.jpgUnPacked.sumTotal==this.jpgUnPacked.packetNum){this.mNum=0;this.imgByte.push(this.jpgUnPacked.imgData);let e=this.bufferAppend(this.imgByte);if(this.jpgUnPacked.jpgLenght===e.byteLength){let i=t.arrayBufferToBase64(e);return i}}else if(this.jpgUnPacked.packetNum===0&&this.mNum===0){this.imgByte=[];this.isRepeat=false;this.imgByte.push(this.jpgUnPacked.imgData)}else if(this.jpgUnPacked.packetNum>0&&this.jpgUnPacked.packetNum===this.mNum+1){this.mNum=this.jpgUnPacked.packetNum;this.imgByte.push(this.jpgUnPacked.imgData)}else if(this.jpgUnPacked.packetNum===0&&this.mNum>0){this.mNum=this.jpgUnPacked.packetNum;return false}else{this.mNum=this.jpgUnPacked.packetNum;this.isRepeat=true;return false}return false}bufferAppend(e){let t=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}let i=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){i.set(new Uint8Array(e[t]),s);s+=e[t].byteLength}return i.buffer}}h.prototype.jpgUnPacked={option:undefined,one:undefined,id:undefined,jpgLenght:undefined,packetNum:undefined,sumTotal:undefined,time:undefined,jpgPacketSize:undefined,rotation:undefined,imgData:undefined};e["TVMirror"]=new h})(window["ESHARECMCLIENTBG"]["background"],window["ESHARECMCLIENTBG"]["Util"],window["ESHARECMCLIENTBG"]["NetWork"]["UdpSocket"],window["ESHARECMCLIENTBG"]["background"]["JpgPackets"]);